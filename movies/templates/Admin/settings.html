{% extends 'Admin/base_admin.html' %}

{% block title %}Settings - Admin Panel{% endblock %}

{% block content %}
<div class="container-fluid my-4">
    <h2 class="mb-4"><i class="bi bi-gear-fill"></i> System Settings</h2>
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-primary bg-gradient text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-sliders"></i> General Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="siteName" class="form-label fw-bold">
                                    <i class="bi bi-building text-primary"></i> Site Name
                                </label>
                                <input type="text" class="form-control" id="siteName" name="site_name" value="{{ settings.site_name }}" required>
                                <small class="text-muted">The name displayed on your website</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="siteEmail" class="form-label fw-bold">
                                    <i class="bi bi-envelope-at text-primary"></i> Site Email
                                </label>
                                <input type="email" class="form-control" id="siteEmail" name="site_email" value="{{ settings.site_email }}" required>
                                <small class="text-muted">Primary contact email for the website</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="itemsPerPage" class="form-label fw-bold">
                                    <i class="bi bi-list-ol text-primary"></i> Items Per Page
                                </label>
                                <input type="number" class="form-control" id="itemsPerPage" name="items_per_page" value="{{ settings.items_per_page }}" min="5" max="100" required>
                                <small class="text-muted">Number of items displayed per page in listings</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="siteLogo" class="form-label fw-bold">
                                    <i class="bi bi-image text-primary"></i> Site Logo
                                </label>
                                <input type="file" class="form-control" id="siteLogo" name="site_logo" accept="image/*">
                                <small class="text-muted">Upload your site logo (PNG, JPG, max 2MB)</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-success bg-gradient text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-chat-quote-fill"></i> Review Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enableReview" name="enable_review" {% if settings.enable_review %}checked{% endif %}>
                                    <label class="form-check-label fw-bold" for="enableReview">
                                        <i class="bi bi-star-fill text-warning"></i> Enable Reviews
                                    </label>
                                </div>
                                <small class="text-muted d-block ms-4">Allow users to submit movie reviews</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="requireApproval" name="require_approval" {% if settings.require_approval %}checked{% endif %}>
                                    <label class="form-check-label fw-bold" for="requireApproval">
                                        <i class="bi bi-shield-check text-info"></i> Require Approval
                                    </label>
                                </div>
                                <small class="text-muted d-block ms-4">Reviews must be approved by admin before being published</small>
                            </div>
                        </div>
                        
                        <div class="alert alert-info border-0 mt-3">
                            <i class="bi bi-info-circle-fill"></i> 
                            <strong>Note:</strong> When "Require Approval" is enabled, all new reviews will be pending until an admin approves them.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-warning bg-gradient text-dark py-3">
                        <h5 class="mb-0"><i class="bi bi-hdd-rack-fill"></i> System Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enableNotification" name="enable_notification" {% if settings.enable_notification %}checked{% endif %}>
                                    <label class="form-check-label fw-bold" for="enableNotification">
                                        <i class="bi bi-bell-fill text-primary"></i> Enable Notifications
                                    </label>
                                </div>
                                <small class="text-muted d-block ms-4">Receive email notifications for new reviews and bookings</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="maintenanceMode" name="maintenance_mode" {% if settings.maintenance_mode %}checked{% endif %}>
                                    <label class="form-check-label fw-bold" for="maintenanceMode">
                                        <i class="bi bi-tools text-danger"></i> Maintenance Mode
                                    </label>
                                </div>
                                <small class="text-muted d-block ms-4">Put the site in maintenance mode (only admins can access)</small>
                            </div>
                        </div>
                        
                        <div class="alert alert-warning border-0 mt-3">
                            <i class="bi bi-exclamation-triangle-fill"></i> 
                            <strong>Warning:</strong> When maintenance mode is enabled, regular users will not be able to access the site.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-info bg-gradient text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-person-circle"></i> Admin Profile</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-sm-4 text-muted">Username:</div>
                            <div class="col-sm-8"><strong>{{ user.username }}</strong></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 text-muted">Email:</div>
                            <div class="col-sm-8"><strong>{{ user.email }}</strong></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 text-muted">Role:</div>
                            <div class="col-sm-8">
                                <span class="badge bg-danger fs-6">
                                    <i class="bi bi-shield-fill-check"></i> {{ user.get_role_display }}
                                </span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 text-muted">Phone:</div>
                            <div class="col-sm-8"><strong>{{ user.phone_number|default:"Not set" }}</strong></div>
                        </div>
                        <hr>
                        <a href="{% url 'profile' %}" class="btn btn-info">
                            <i class="bi bi-pencil-square"></i> Edit Profile
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-dark bg-gradient text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-shield-lock-fill"></i> Account Security</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-sm-5 text-muted">Account Created:</div>
                            <div class="col-sm-7"><strong>{{ user.created_at|date:"F d, Y" }}</strong></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-5 text-muted">Last Updated:</div>
                            <div class="col-sm-7"><strong>{{ user.updated_at|date:"F d, Y" }}</strong></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-5 text-muted">Account Status:</div>
                            <div class="col-sm-7">
                                <span class="badge bg-success fs-6">
                                    <i class="bi bi-check-circle-fill"></i> Active
                                </span>
                            </div>
                        </div>
                        <hr>
                        <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                            <i class="bi bi-key-fill"></i> Change Password
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body text-center py-4">
                        <button type="submit" class="btn btn-success btn-lg px-5">
                            <i class="bi bi-check-circle-fill"></i> Save All Settings
                        </button>
                        <button type="reset" class="btn btn-secondary btn-lg px-5 ms-2">
                            <i class="bi bi-x-circle"></i> Reset Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="changePasswordModalLabel">
                    <i class="bi bi-key-fill"></i> Change Password
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm" method="post" action="#">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="currentPassword" name="current_password" required>
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="newPassword" name="new_password" required>
                        <small class="text-muted">Minimum 8 characters</small>
                    </div>
                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirmPassword" name="confirm_password" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="changePasswordForm" class="btn btn-dark">
                    <i class="bi bi-check-circle"></i> Change Password
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
